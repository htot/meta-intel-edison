<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>Building and installing the kernel | Edison</title>
    
    <base>
    <meta name="description" content=" Building the kernel Installing the kernel  Building the kernel You will find the kernel image here: tmp/deploy/images/edison  as... " >
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" value="notranslate">
    <link rel="icon"  type="image/x-icon" href="assets/favicon.ico">

    <!-- FontAwesome (GPL license) -->
   <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- jQuery (MIT license)-->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <!-- jQuery cookie (MIT license)-->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <!-- Navgoco (BSD license)-->
    <script type="text/javascript" src="assets/js/jquery.navgoco.min.js"></script>
    <!-- Bootstrap (MIT license)-->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- Anchor JS (MIT license)-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
        <script>
        $( document ).ready(function() {
            anchors.add('h2,h3,h4,h5');
            $('[data-toggle="tooltip"]').tooltip();
        });
        </script>
    

    <script>
        $( document ).ready(function() {
            $("#docnavsidebar").navgoco({
                caretHtml: '',
                accordion: false,
                openClass: 'open', // open
                save: true,
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 300,
                    easing: 'swing'
                }
            });
            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#docnavsidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#docnavsidebar").navgoco('toggle', true);
            });
        });

    </script>

 <!-- For responsive button to toggle sidebar -->
    <script>
        $(document).ready(function() {
            $('[data-toggle=offcanvas]').click(function() {
                $('.row-offcanvas').toggleClass('active');
            });
        });
    </script>

    <!-- User defined js -->
    <script src="assets/js/user_defined_javascript.js"></script>
    <!--Bootstrap (MIT license) -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <!-- Original theme from Bootstrap Bootswatch fork: http://www.codeply.com/go/rV7KhUjwCN (MIT license) -->
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="stylesheet" href="assets/css/user_defined_web_styles.css" />
    <style>
        ul#markdown-toc::before  {
        content: "Table of Contents"
         }
    </style>

</head>
<body class="default">
<div class="page-container">


    <!-- Top Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container topnavlinks">
            <div class="navbar-header">
              
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="fa fa-bars fa-2x"></span>
                </button>
                
                
                <button type="button" class="navbar-toggle toggle-sidebar-button"  data-toggle="offcanvas" data-target=".sidebar-nav">
                    <span class="sidebarToggle fa fa-columns fa-2x"></span>
                </button>
                


                  

            </div>

            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-left">

                    <!-- single item nav items appear here -->

                    
                    
                    
                    

                          <!-- drop-down nav items appear here -->

                    
                    
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Sample Menu<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
                            
                            <li><a href="https://talk.jekyllrb.com" class="noExtIcon">First item</a></li>
                            
                            
                            
                            <li><a href="http://amazon.com" class="noExtIcon">Second item</a></li>
                            
                            
                            
                            <li><a href="http://nytimes.com" class="noExtIcon">Third item</a></li>
                            
                            
                            
                            <li><a href="http://google.com" class="noExtIcon">Fourth item</a></li>
                            
                            
                        </ul>
                    </li>

                    
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Another menu<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
                            
                            <li><a href="index.html">Getting Started</a></li>
                            
                            
                            
                            <li><a href="jekyllhowto-content-and-formatting.html">Content and Formatting</a></li>
                            
                            
                            
                            <li><a href="jekyllhowto-sidebar-navigation.html">Sidebar navigation</a></li>
                            
                            
                        </ul>
                    </li>

                    
                    

                    
                    <li><a target="_blank" href="https://github.com/htot/meta-intel-edison//_docs/Edison/Building/4-Building-and-installing-the-kernel.md" class="editButton noExtIcon"><i class="fa fa-github fa-lg"></i> Edit on GitHub</a>
</li>
                    


                </ul>
                

                <ul class="nav navbar-nav navbar-right">
                    <li>

                     <div id="search-topnav-container">
                        <form action="search.html" method="get">
                          <div class="input-group search">
                            <input type="text" id="search-box" name="query" class="form-control" placeholder="Search ...">
                            <div class="input-group-btn">
                              <button class="btn btn-default" type="submit" value="search">
                                <i class="glyphicon glyphicon-search"></i>
                              </button>
                            </div>
                          </div>
                        </form>
                        </div>


                    </li>
                </ul>
                
            </div>

        </div>


        <!-- /.container -->
    </nav>

<div class="container">
        <div class="row row-offcanvas row-offcanvas-left">

            <!-- sidebar -->
            <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">

                
<div class="mydocsidebar">


<div class="sidebar-inner">


  


<div class="productTitle">Generic</div>
<p class="external">
    <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
</p>



    <ul id="docnavsidebar" class="docnav">
    
    
        
    
    <li class="level1"><a href="#">Introduction</a>
        <ul>
            

            
            
            <li class="level1items"><a href="0.1-A-word-of-warning.html">A Word of Warning</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="0.2-About-me.html">About me</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="0.3-What-is-here.html">What is here</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="0.4-Bug-feature-testing.html">Bugs, Feature & Testing</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="0.5-Road-map.html">Roadmap</a></li>
            
            

            

            
        </ul>

        
    
    <li class="level1"><a href="#">Setting up</a>
        <ul>
            

            
            
            <li class="level1items"><a href="1-Prerequisites-for-building.html">Prerequisites for building</a></li>
            
            

            

            

            
            
            <li class="level1items"><a href="2-Setting-up.html">Setting up</a></li>
            
            

            

            
        </ul>

        
    
    <li class="level1"><a href="#">Building</a>
        <ul>
            

            
            
            <li class="level1items"><a href="3-Building-and-installing-the-rootfs.html">Building and installing the rootfs</a></li>
            
            

            

            

            
            
            <li class="level1items open"><a href="4-Building-and-installing-the-kernel.html">Building and installing the kernel</a></li>
            
            

            

            
        </ul>

        
    
    <li class="level1"><a href="#">SDK</a>
        <ul>
            

            
            
            <li class="level1items"><a href="3-Building-the-SDK.html">Building and installing the SDK</a></li>
            
            

            

            
        </ul>

        

    </li>
</ul>

<hr class="resourceSeparator"></hr>
<div class="relatedResources">Other Resources</div>
<ul id="entrypages">
        
        <li><a class="noExtIcon" href="">Other Documentation</a></li>
        
    </li>
</ul>
</div>
</div>
<script>$("li.open").parents('li').toggleClass("open");</script>


            </div>

            <!-- main area -->
            <div class="col-xs-12 col-sm-9 main">

                    <div class="subtitle">
                    


<a href="http://pages.github.com/htot" class="noExtIcon productSubtitle">Home</a>&nbsp;&nbsp;>&nbsp;&nbsp;Edison&nbsp;&nbsp;>&nbsp;&nbsp;Building
    




                      </div>

                      


                    <h1>Building and installing the kernel</h1>

                
                    <ul id="markdown-toc">
  <li><a href="#building-the-kernel" id="markdown-toc-building-the-kernel">Building the kernel</a></li>
  <li><a href="#installing-the-kernel" id="markdown-toc-installing-the-kernel">Installing the kernel</a></li>
</ul>
<h3 id="building-the-kernel">Building the kernel</h3>

<p>You will find the kernel image here:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tmp/deploy/images/edison
</code></pre></div></div>

<p>as well as:</p>

<ol>
  <li>
    <p>The u-boot image <code class="highlighter-rouge">u-boot.bin</code></p>

    <table>
      <tbody>
        <tr>
          <td>This is currently not working for dizzy- or morty- branches. It might not even be there. For pyro64, the u-boot recipy has been fixed but needs to be baked seperately, see [[6.1 Building U-boot from within Yocto</td>
          <td>6.1 Building U-boot from within Yocto]]. The pyro64 recipe can be backported to morty, but I don’t have any direct use for that. If you need that, file a bug for this.</td>
        </tr>
      </tbody>
    </table>

    <p>For dizzy- or morty- branches the u-boot recipe needs a bit more work. If you use the generated u-boot image, the Edison will not boot and you will need recovery.</p>

    <p>Yocto will correctly clone <code class="highlighter-rouge">github.com.andy-shev.u-boot.git</code> (in <code class="highlighter-rouge">bbcache/downloads/git2</code>).</p>

    <table>
      <tbody>
        <tr>
          <td>You are better off to clone this again and follow the instructions in [[6.2 Build and Flash U-Boot outside of Yocto</td>
          <td>6.2 Build and Flash U-Boot outside of Yocto]].</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>The modules gzip file <code class="highlighter-rouge">modules-edison.tgz</code>.</p>

    <p>If you are feeling adventurous, you can ungzip this in the root of your current image and see if you are able to boot that using the Vanilla kernel.</p>

    <p>You don’t need this kernel image right now. We will be building kernel with initramfs (that is with an internal file system that will be used to load certain kernel modules on boot).</p>

    <p>The modules in the initramfs will activate the sd card, allowing the kernel to boot from there. After loading the modules, the <code class="highlighter-rouge">init</code> program will try to mount all disks search for the one specified on the kernel command line, check if there is an <code class="highlighter-rouge">init</code> and if so remount the filesystem and switchroot to the new <code class="highlighter-rouge">init</code>. All of this is taken care of by the script <code class="highlighter-rouge">meta-intel-edison/meta-intel-edison-distro/recipes-core/initrdscripts/files/init-live.sh</code>.</p>

    <p>Note: In case of problems booting, specify <code class="highlighter-rouge">debugshell</code> on the kernel command line. This will fall back to a busybox prompt after waiting 30 seconds for a bootable disk.</p>
  </li>
  <li>
    <p>The following command will build a kernel with built-in <code class="highlighter-rouge">initramfs</code>, that will be able to boot the <code class="highlighter-rouge">rootfs</code> on the sdcard:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bitbake -R conf/initramfs.conf core-image-minimal-initramfs
</code></pre></div>    </div>

    <p>The <code class="highlighter-rouge">cpio</code> holding the <code class="highlighter-rouge">initramfs</code>: <code class="highlighter-rouge">core-image-minimal-initramfs-edison.cpio.gz</code></p>

    <p>We will not be using this.</p>
  </li>
</ol>

<h3 id="installing-the-kernel">Installing the kernel</h3>
<p>The kernel with the built-in <code class="highlighter-rouge">initramfs</code> is called <code class="highlighter-rouge">bzImage-initramfs-edison.bin</code>.</p>

<p>We will put this on the internal mmc partition <code class="highlighter-rouge">/dev/mmcblk0p9</code>.</p>

<p>Before you can copy the file there we need to format this partition. Don’t worry, this will not disturb operation of your current image as it was previously used for OTA (over the air) updates, but that feature is no longer supported.</p>

<p>While running the original Intel® provided firmware, create a FAT file system on device 0:9. (If you don’t, and save files on the originally-available file system, they will not be visible from U-Boot.)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    mkfs.vfat -F32 -I /dev/mmcblk0p9
</code></pre></div></div>

<p>Reboot the Edison.</p>

<p>Mount the Edison’s now-visible drive on the host computer (using the extra USB cable). Copy the just-built Linux image to the Edison drive:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    cp tmp/deploy/images/edison/bzImage-initramfs-edison.bin /&lt;path-to-Edison-drive&gt;/bzImage-initramfs

Alternatively, on the edison (with the original firmware):

    mount /dev/mmcblk0p9 /mnt
</code></pre></div></div>

<p>(Or, if the Edison already runs the morty firmware, copy the file to /boot, don’t forget to unmount and reboot after that).</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    mount /dev/mmcblk0p9 /mnt
</code></pre></div></div>

<p>And if you have sshd running on the edison, from your host:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    scp tmp/deploy/images/edison/bzImage-initramfs-edison.bin root@edison:
</code></pre></div></div>

<p>Then on the Edison:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    mv bzImage-initramfs-edison.bin /mnt/bzImage-initramfs
    umount /mnt
</code></pre></div></div>

<p>Or all the above from KDE’s Dolphin using the <code class="highlighter-rouge">path fish://root@edison</code></p>


                  

                    



            </div>
        </div><!--/.container-->


    </div><!--/.page-container-->
    <!-- * Bootsnipp footer: http://bootsnipp.com/snippets/1KEEq (MIT license) -->

<div class="footertop">
    <div class="container">
        <div class="col-md-6">
            <p></p>
        </div>
        <div class="col-md-6">
            <ul class="bottom_ul">
        </div>
    </div>
</div>

<footer>
    <div class="container">
        <div class="row">
            <div class="col-md-5 col-sm-6 footerleft ">


              
                        <div class="logofooter"> About the Documentation</div>
                <p class="footer-description">This is the onofficial Yocto for Edison Arduino documentation. You will find instructions how to setup a current Yocto, build recent U-Boot and Linux kernel and install tools on the rootfs.
</p>

            </div>
            <div class="col-md-2 col-sm-6 paddingtop-bottom">
                <h6 class="heading7">Column 1</h6>
                <ul class="footer-ul">
                  
                    <li><a class="noExtIcon" href="http://someurl1.com"> Column 1 Link 1</a></li>
                    
                    <li><a class="noExtIcon" href="http://someurl2.com"> Column 1 Link 2</a></li>
                    
                    <li><a class="noExtIcon" href="http://someurl3.com"> Column 1 Link 3</a></li>
                    
                    <li><a class="noExtIcon" href="http://someurl4.com"> Column 1 Link 4</a></li>
                    
                    <li><a class="noExtIcon" href="http://someurl5.com"> Column 1 Link 5</a></li>
                    
                    <li><a class="noExtIcon" href="http://someurl6.com"> Column 1 Link 6</a></li>
                    
                    <li><a class="noExtIcon" href="http://someurl7.com"> Column 1 Link 7</a></li>
                    
                    <li><a class="noExtIcon" href="http://someurl8.com"> Column 1 Link 8</a></li>
                    
                </ul>
            </div>

            <div class="col-md-2 col-sm-6 paddingtop-bottom">
              <h6 class="heading7">Column 2</h6>
              <ul class="footer-ul">
                
                  <li><a class="noExtIcon" href="http://someurl1.com"> Column 2 Link 1</a></li>
                  
                  <li><a class="noExtIcon" href="http://someurl2.com"> Column 2 Link 2</a></li>
                  
                  <li><a class="noExtIcon" href="http://someurl3.com"> Column 2 Link 3</a></li>
                  
                  <li><a class="noExtIcon" href="http://someurl4.com"> Column 2 Link 4</a></li>
                  
                  <li><a class="noExtIcon" href="http://someurl5.com"> Column 2 Link 5</a></li>
                  
                  <li><a class="noExtIcon" href="http://someurl6.com"> Column 2 Link 6</a></li>
                  
                  <li><a class="noExtIcon" href="http://someurl7.com"> Column 2 Link 7</a></li>
                  
                  <li><a class="noExtIcon" href="http://someurl8.com"> Column 2 Link 8</a></li>
                  
              </ul>
            </div>

            <div class="col-md-3 col-sm-6 paddingtop-bottom">
              <h6 class="heading7">Column 3</h6>
              <ul class="footer-ul">
                
                  <li><a class="noExtIcon" href="http://someurl1.com"> Column 3 Link 1</a></li>
                  
                  <li><a class="noExtIcon" href="http://someurl2.com"> Column 3 Link 2</a></li>
                  
                  <li><a class="noExtIcon" href="http://someurl3.com"> Column 3 Link 3</a></li>
                  
                  <li><a class="noExtIcon" href="http://someurl4.com"> Column 3 Link 4</a></li>
                  
                  <li><a class="noExtIcon" href="http://someurl5.com"> Column 3 Link 5</a></li>
                  
                  <li><a class="noExtIcon" href="http://someurl6.com"> Column 3 Link 6</a></li>
                  
                  <li><a class="noExtIcon" href="http://someurl7.com"> Column 3 Link 7</a></li>
                  
                  <li><a class="noExtIcon" href="http://someurl8.com"> Column 3 Link 8</a></li>
                  
              </ul>
            </div>


        </div>
    </div>
    </div>
</footer>
<!--subfooter start from here -->

<div class="copyright">
    <div class="container">
        <div class="col-md-12">
            <p>© 2018 Ferry Toth</p>
        </div>
    </div>
</div>


    <!-- the google_analytics_id gets auto inserted from the config file -->




</body>

</html>
